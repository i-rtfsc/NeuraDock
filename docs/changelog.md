# 更新日志

本文件记录 NeuraDock 的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

_暂无更新_

---

## [0.5.0] - 2025-12-21

### 新增

#### 核心功能
- **批量凭证更新**：新增 BatchUpdateDialog，支持 JSON 导入、批量修改与「不存在则创建」策略，适合一次性同步大量账号
- **高级签到分析**：签到记录页新增月度概览、趋势图、断签提醒与日历跳转，帮助快速定位收益波动
- **余额总览重构**：Accounts 与 Dashboard 支持 Provider 级统计、全局总额、历史消耗对比，适配新的 `total_quota` 语义
- **可配置签到间隔**：支持为每个账号设置自定义签到间隔（默认24小时），避免频繁签到导致的限制
- **代理配置**：新增应用内代理配置功能，支持 HTTP/HTTPS/SOCKS5 代理设置
- **Provider节点管理**：支持添加、编辑和删除自定义 API 节点，灵活适配不同的中转站配置

#### 架构改进
- **类型安全 IPC**：引入 tauri-specta，实现 TypeScript 绑定自动生成，提供完整的类型安全保障
- **DDD 层解耦**：应用层与基础设施层完全解耦，移除 sqlx 对上层的依赖，改善代码可维护性
- **模块化重构**：后端代码按职责拆分为多个专注的子模块，提升代码组织和可读性

#### 性能优化
- **启动性能**：优化应用启动流程，减少初始化时间约 40%
- **Vendor Chunks**：前端构建拆分 vendor chunks，提升加载速度和缓存效率
- **调度器优化**：调度器仅加载已启用账号，减少内存占用和调度开销
- **窗口持久化**：支持窗口大小和位置持久化，提升用户体验

#### 用户体验
- **窗口拖拽**：支持从页面空白区域拖拽窗口，提升操作便利性
- **国际化完善**：新增更多界面文本的中英文翻译，提升多语言支持
- **错误处理**：改进错误提示信息，避免 panic，提供更友好的错误反馈

### 变更

#### 重大变更（Breaking Changes）
- **统一配额字段**：
  - 数据库、DTO、前端与通知全面切换为 `total_quota`（总配额）语义
  - 淘汰历史的 `total_income = quota + used_quota` 定义
  - 如果从 0.1.0 升级，余额数据将自动迁移，但建议检查数据一致性

#### 通知系统
- **通知文案升级**：飞书通知支持「昨日 / 今日 / 差值」三段式对比
- **智能回退**：在缺少历史记录时自动回退到最近一次记录，确保通知可用性

#### 依赖更新
- **前端依赖升级**：
  - React Query → TanStack Query v5
  - Vite 升级到 6.x
  - React Router 升级到最新版本
  - 提升性能与开发体验（DX）

#### 开发工具
- **Makefile 简化**：保留常用命令，移除冗余 target，输出更清晰
- **CI/CD 优化**：改进 GitHub Actions 工作流，支持多平台并行构建
- **测试完善**：新增和修复后端测试用例，提升代码质量

### 修复

#### 功能修复
- 修复飞书通知仅展示今日余额的问题，恢复完整的三段式对比格式
- 修复批量签到结果缺少账号上下文信息的问题
- 修复窗口拖拽在某些情况下不可靠的问题
- 修复 Provider 节点 URL 验证逻辑错误

#### 后端修复
- 修复查询和 i18n 模块中可能导致 panic 的代码
- 移除不安全的事务模块，改用更安全的实现
- 修复签到间隔期望值不一致的测试用例

#### 前端修复
- 移除重复的 PageContainer 组件，统一布局组件
- 修复 Tauri invoke 参数对齐问题
- 修复主题切换和 UI 显示问题

### 安全

#### 改进
- 改进错误处理，避免敏感信息泄露到日志
- 持续推进凭证加密（计划在 0.6.0 完成）
- 最小化日志输出，减少潜在的信息泄露风险

### 性能

#### 测量与改进
- 添加性能监控和基准测试框架
- 启动时间优化（减少约 40%）
- 前端首次加载时间优化（减少约 30%）
- 调度器内存占用优化（仅加载已启用账号）

### 文档

#### 文档完善
- **发布指南**：新增完整的版本发布流程文档
- **开发文档**：更新开发指南，覆盖 0.5.0 的架构变更
- **README 重写**：中英文 README 全面重写，反映最新功能和架构
- **CHANGELOG**：详细记录所有变更，便于用户和开发者了解版本差异

### 已知问题

- 凭证仍以明文存储（计划在 0.6.0 实现加密）
- 某些通知渠道（Email、Telegram）功能尚未完成
- 部分高级功能（模型使用统计）仍在开发中

---

## [0.1.0] - 2025-11-11

### 新增
- NeuraDock 初始发布
- 基于 Tauri 2 + Rust + React 的 DDD + CQRS 架构
- 服务商多账号管理
- 手动和批量签到功能
- 可配置时间的自动签到调度
- 带缓存策略的余额追踪
- 使用浏览器自动化 (chromiumoxide) 的 WAF 绕过
- 会话缓存以减少浏览器自动化开销
- 账号 JSON 导入/导出
- 国际化支持（English, 简体中文）
- SQLite 数据库自动迁移
- 使用 tauri-specta 的类型安全 IPC

### 支持的服务商
- AnyRouter（需要 WAF 绕过）
- AgentRouter

### 已知问题
- 数据库中凭证未加密存储
- 部分命令尚未实现（历史、统计）
- 通知系统仅为占位符

---

## 版本历史

| 版本 | 日期 | 亮点 |
|------|------|------|
| 0.5.0 | 2025-12-21 | 配额语义统一 & 高级签到分析 |
| 0.1.0 | 2025-01-21 | 初始发布 |

---

## 升级说明

### 升级到 0.2.0（未来）

当 0.2.0 发布凭证加密功能时：

1. 升级前**备份数据库**
2. 现有凭证将自动迁移
3. 如果迁移失败，从 JSON 备份重新导入账号

### 数据库迁移

数据库迁移在应用启动时自动运行。无需手动干预。

**注意**：迁移无法回滚。升级前请务必备份。
